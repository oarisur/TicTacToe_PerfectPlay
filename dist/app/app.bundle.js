!function(){"use strict";const e=(()=>{let e=["","","","","","","","",""];return{getBoard:()=>e,setBoard:t=>{e=t},reset:()=>{e=["","","","","","","","",""]},markCell:(t,a)=>""===e[t]&&(e[t]=a,!0)}})(),t="O",a=100,s=-100,o=0,n=e=>e.map((e,t)=>""===e?t:-1).filter(e=>-1!==e),r=(e,t,a)=>{for(const s of a){const[a,o,n]=s;if(e[a]===t&&e[o]===t&&e[n]===t)return!0}return!1},d=(e,t,a)=>{for(const s of a){const[a,o,n]=s,r=[e[a],e[o],e[n]],d=r.findIndex(e=>""===e);if(-1!==d&&2===r.filter(e=>e===t).length)return s[d]}return-1},l=(e,d,i,c)=>{if(r(e,"X",c))return{score:s+i};if(r(e,t,c))return{score:a-i};if(0===n(e).length)return{score:o};const m=[],u=n(e);for(const a of u){const s={index:a},o=[...e];o[a]=d,s.score=d===t?l(o,"X",i+1,c).score:l(o,t,i+1,c).score,m.push(s)}let p;if(d===t){let e=-1/0;for(const t of m)t.score>e&&(e=t.score,p=t)}else{let e=1/0;for(const t of m)t.score<e&&(e=t.score,p=t)}return p},i=(()=>{let e;return{getBestMove:(a,s)=>{const o=n(a);if(0===o.length)return-1;if("hard"===s)return l(a,t,0,e).index;let r=d(a,t,e);if(-1!==r)return r;let i=d(a,"X",e);return-1!==i&&"medium"===s?i:""===a[4]&&"medium"===s?4:o[Math.floor(Math.random()*o.length)]},init:t=>{e=t}}})(),c="tictactoe_stats_pro",m="tictactoe_state_pro",u="tictactoe_theme_pro",p="tictactoe_mute_pro",g=(()=>{const e=[u,p];return{load:(t,a)=>{const s=localStorage.getItem(t);if(!s)return a;if(e.includes(t))return s;try{return JSON.parse(s)}catch(e){return console.error(`LocalStore: Failed to parse data for ${t}. Falling back to default.`,e),a}},save:(t,a)=>{try{let s;s=e.includes(t)?String(a):JSON.stringify(a),localStorage.setItem(t,s)}catch(e){console.error(`LocalStore: Failed to save data for ${t}. Storage limit may be reached.`,e)}},removeItem:e=>localStorage.removeItem(e)}})();let y={pvai:{total:{wins:0,losses:0,draws:0},easy:{wins:0,losses:0,draws:0},medium:{wins:0,losses:0,draws:0},hard:{wins:0,losses:0,draws:0}},pvp:{X:{wins:0,losses:0,draws:0},O:{wins:0,losses:0,draws:0}}};const v=(()=>{let e={};return{loadStats:()=>{const e=JSON.parse(JSON.stringify(y)),t=g.load(c,e);y=t;let a=0,s=0,o=0;a+=y.pvai.easy.wins+y.pvai.medium.wins+y.pvai.hard.wins,s+=y.pvai.easy.losses+y.pvai.medium.losses+y.pvai.hard.losses,o+=y.pvai.easy.draws+y.pvai.medium.draws+y.pvai.hard.draws,y.pvai.total={wins:a,losses:s,draws:o}},recordGameResult:(e,t,a)=>{if("pvai"===t){const t="X"===e?"win":"O"===e?"loss":"draw",s=y.pvai[a];s&&("win"===t?s.wins++:"loss"===t?s.losses++:"draw"===t&&s.draws++),"win"===t?y.pvai.total.wins++:"loss"===t?y.pvai.total.losses++:"draw"===t&&y.pvai.total.draws++}else"pvp"===t&&("X"===e?(y.pvp.X.wins++,y.pvp.O.losses++):"O"===e?(y.pvp.O.wins++,y.pvp.X.losses++):(y.pvp.X.draws++,y.pvp.O.draws++));g.save(c,y)},saveGameState:(e,t,a,s)=>{const o={board:e,currentPlayer:t,mode:a,difficulty:s};g.save(m,o)},deleteGameState:()=>g.removeItem(m),updateStatsUI:(t,a)=>{const s=document.getElementById("stats-pvai"),o=document.getElementById("stats-pvp");if("pvai"===t){s?.classList.remove("hidden"),o?.classList.add("hidden");const t=y.pvai[a]||y.pvai.total;e.pvai.wins&&(e.pvai.wins.textContent=t.wins),e.pvai.losses&&(e.pvai.losses.textContent=t.losses),e.pvai.draws&&(e.pvai.draws.textContent=t.draws)}else s?.classList.add("hidden"),o?.classList.remove("hidden"),e.pvp.xWins&&(e.pvp.xWins.textContent=y.pvp.X.wins),e.pvp.oWins&&(e.pvp.O.wins.textContent=y.pvp.O.wins),e.pvp.draws&&(e.pvp.draws.textContent=y.pvp.X.draws)},initDom:()=>{e={pvai:{wins:document.getElementById("stat-wins"),losses:document.getElementById("stat-losses"),draws:document.getElementById("stat-draws")},pvp:{xWins:document.getElementById("pvp-x-wins"),oWins:document.getElementById("pvp-o-wins"),draws:document.getElementById("pvp-draws")}}}}})();let w,f,I,h,S,x,B="true"===g.load(p,"false");const E=e=>{!B&&e&&(e.currentTime=0,e.play().catch(e=>console.warn("Audio playback failed (browser interaction policy or missing file):",e)))},L={playMoveSound:()=>E(w),playWinSound:()=>E(f),playDrawSound:()=>E(I),playLossSound:()=>E(h),playAISound:()=>E(S),toggleMute:()=>{B=!B,x.textContent=B?"ðŸ”‡":"ðŸ”Š",g.save(p,B?"true":"false")},loadMuteSetting:()=>{x&&(x.textContent=B?"ðŸ”‡":"ðŸ”Š")},initDom:()=>{w=document.getElementById("audio-move"),f=document.getElementById("audio-win"),I=document.getElementById("audio-draw"),h=document.getElementById("audio-loss"),S=document.getElementById("audio-ai-start"),x=document.getElementById("mute-toggle")}};let C="X",b=!0,P="medium",M="pvai";const k=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];let O={};const X=(()=>{const t=document.querySelectorAll('input[name="difficulty"]'),a=document.querySelectorAll('input[name="game-mode"]'),s=()=>({mode:Array.from(a).find(e=>e.checked)?.value||M,difficulty:Array.from(t).find(e=>e.checked)?.value||P,currentPlayer:C}),o=()=>{const t=e.getBoard(),a=i.getBestMove(t,P);-1!==a&&r(a)},n=()=>{C="X"===C?"O":"X",O.updateMessage(`Player ${C}'s turn`,C),O.updatePlayerIndicator(C,M),b&&v.saveGameState(e.getBoard(),C,M,P),"pvai"===M&&"O"===C&&b?(O.toggleBoardInteraction(!1),L.playAISound(),setTimeout(o,700)):"pvai"===M&&"X"===C&&b&&O.toggleBoardInteraction(!0)},r=t=>{b&&e.markCell(t,C)&&(O.render(e.getBoard()),L.playMoveSound(),(()=>{const t=e.getBoard();for(const e of k){const[a,s,o]=e;if(t[a]&&t[a]===t[s]&&t[a]===t[o]){b=!1;const s=t[a];return v.recordGameResult(s,M,P),O.showResult(`Player ${s} WINS!`,s,e),O.toggleBoardInteraction(!1),v.deleteGameState(),"pvai"===M&&"O"===s?L.playLossSound():L.playWinSound(),!0}}return!t.includes("")&&(b=!1,v.recordGameResult(null,M,P),O.showResult("It's a DRAW!",null,null),O.toggleBoardInteraction(!1),v.deleteGameState(),L.playDrawSound(),!0)})()||n())},d=(t=!1)=>{const a=s();t||(v.deleteGameState(),e.reset()),P=a.difficulty,M=a.mode,C="X",b=!0,O.resetUI(),O.render(e.getBoard()),O.updateMessage(`Player ${C}'s turn`,C),O.updatePlayerIndicator(C,M),O.setModeState(M,P),v.updateStatsUI(M,P),O.toggleBoardInteraction(!0),"pvai"===M&&"O"===C&&(O.toggleBoardInteraction(!1),L.playAISound(),setTimeout(o,700))};return{handlePlayerMove:r,startGame:d,getWinningConditions:()=>k,getCurrentSettings:s,loadGameState:()=>{v.loadStats(),i.init(k);const e=g.load(m,null);e&&e.board&&e.board.some(e=>""!==e)?O.showResumePrompt(e):d()},resumeGame:t=>{e.setBoard(t.board),C=t.currentPlayer,M=t.mode,P=t.difficulty,b=!0,O.resetUI(),O.render(e.getBoard()),O.updateMessage(`Player ${C}'s turn`,C),O.updatePlayerIndicator(C,M),O.setModeState(M,P),v.updateStatsUI(M,P),O.toggleBoardInteraction(!0),"pvai"===M&&"O"===C&&(O.toggleBoardInteraction(!1),L.playAISound(),setTimeout(o,700))},setDisplayCallbacks:e=>{O=e}}})();let G;const A={toggleTheme:()=>{document.body.classList.toggle("light-theme");const e=document.body.classList.contains("light-theme");G.textContent=e?"ðŸŒ™":"â˜€ï¸",g.save(u,e?"light":"dark")},loadTheme:()=>{"light"===g.load(u,"dark")?(document.body.classList.add("light-theme"),G.textContent="ðŸŒ™"):(document.body.classList.remove("light-theme"),G.textContent="â˜€ï¸")},initDom:()=>{G=document.getElementById("theme-toggle")}};let D,R,W,T,U,$,_,N,q,J,F,H,j={};const z=(()=>{const e=(e,t)=>{q.classList.remove("active-X"),J.classList.remove("active-O"),J.textContent="pvai"===t?"AI":"Player O","X"===e?q.classList.add("active-X"):"O"===e&&J.classList.add("active-O")},t=(e,t)=>{R.textContent=e,R.className="text-base sm:text-lg font-semibold text-center h-6 flex items-center justify-center transition-colors","X"===t?R.classList.add("text-player-X"):"O"===t?R.classList.add("text-player-O"):e.includes("WINS")?R.classList.add("text-green-400"):e.includes("DRAW")?R.classList.add("text-yellow-400"):R.classList.add("text-gray-400")},a=(e,t)=>{document.getElementById(`mode-${e}`).checked=!0,document.getElementById(`diff-${t}`).checked=!0,"pvai"===e?($.style.opacity="1",$.style.maxHeight="50px",$.style.pointerEvents="auto",J.textContent="AI"):($.style.opacity="0",$.style.maxHeight="0",$.style.pointerEvents="none",J.textContent="Player O"),$.style.transition="opacity 0.3s ease-in-out, max-height 0.3s ease-in-out"};return{render:e=>{D.forEach((t,a)=>{const s=e[a];t.textContent=s,t.classList.remove("text-player-X","text-player-O","cell-winner"),t.dataset.marker=s,t.dataset.nextPlayerMarker="",s&&t.classList.add(`text-player-${s}`)})},updateMessage:t,showResult:(a,s,o)=>{W.classList.add("show"),document.getElementById("message-content").textContent=a,t(a,null),e(null),T.style.borderColor="var(--brand-accent)",U.style.backgroundColor="var(--brand-accent)",o&&o.forEach(e=>{D[e].classList.add("cell-winner")})},resetUI:()=>{D.forEach(e=>{e.textContent="",e.classList.remove("text-player-X","text-player-O","cell-winner"),e.dataset.marker="",e.dataset.nextPlayerMarker=""}),W.classList.remove("show"),_.classList.remove("show"),q.classList.remove("active-X"),J.classList.remove("active-O"),T.style.borderColor="var(--brand-accent)",R.textContent="Ready to Play!",N.classList.remove("board-inactive")},setModeState:a,showResumePrompt:e=>{_.classList.add("show"),a(e.mode,e.difficulty),v.updateStatsUI(e.mode,e.difficulty)},updatePlayerIndicator:e,toggleBoardInteraction:e=>{e?N.classList.remove("board-inactive"):N.classList.add("board-inactive")},setupListeners:()=>{D.forEach(e=>{e.addEventListener("click",e=>{const t=parseInt(e.target.dataset.index);j.handlePlayerMove(t)}),e.addEventListener("mouseover",()=>{const t=j.getCurrentSettings();if(""!==e.textContent||"pvp"!==t.mode&&"X"!==t.currentPlayer||N.classList.contains("board-inactive"))e.dataset.nextPlayerMarker="";else{const a=t.currentPlayer||"X";e.dataset.nextPlayerMarker=a,document.documentElement.style.setProperty("--current-player-color",`var(--brand-${a.toLowerCase()})`)}}),e.addEventListener("mouseout",()=>{e.dataset.nextPlayerMarker=""})}),document.getElementById("reset-button").addEventListener("click",()=>j.startGame(!1)),document.getElementById("close-message-box").addEventListener("click",()=>{W.classList.remove("show"),j.startGame(!1)});const e=()=>{const e=j.getCurrentSettings();a(e.mode,e.difficulty),j.startGame(!1),v.updateStatsUI(e.mode,e.difficulty)};H.forEach(t=>t.addEventListener("change",e)),F.forEach(t=>t.addEventListener("change",e)),document.getElementById("resume-button").addEventListener("click",()=>{_.classList.remove("show");const e=g.load(m,null);e&&j.resumeGame(e)}),document.getElementById("new-game-button").addEventListener("click",()=>{_.classList.remove("show"),j.startGame(!1)}),document.getElementById("theme-toggle").addEventListener("click",A.toggleTheme),document.getElementById("mute-toggle").addEventListener("click",L.toggleMute)},initDom:()=>{D=document.querySelectorAll(".cell"),R=document.getElementById("message"),W=document.getElementById("custom-message-box"),T=document.getElementById("message-content-card"),U=document.getElementById("close-message-box"),$=document.getElementById("difficulty-wrapper"),_=document.getElementById("resume-prompt"),N=document.getElementById("game-board"),q=document.getElementById("player-x-turn"),J=document.getElementById("player-o-turn"),F=document.querySelectorAll('input[name="difficulty"]'),H=document.querySelectorAll('input[name="game-mode"]'),v.initDom()},setInteractionCallbacks:e=>{j=e}}})();document.addEventListener("DOMContentLoaded",()=>{console.log("--- ðŸš€ Initializing TicTacToe: Perfect Play App ---"),z.initDom(),A.initDom(),L.initDom(),v.initDom(),X.setDisplayCallbacks({render:z.render,updateMessage:z.updateMessage,updatePlayerIndicator:z.updatePlayerIndicator,showResult:z.showResult,resetUI:z.resetUI,setModeState:z.setModeState,showResumePrompt:z.showResumePrompt,toggleBoardInteraction:z.toggleBoardInteraction}),z.setInteractionCallbacks({handlePlayerMove:X.handlePlayerMove,getCurrentSettings:X.getCurrentSettings,startGame:X.startGame,resumeGame:X.resumeGame}),A.loadTheme(),L.loadMuteSetting(),z.setupListeners(),X.loadGameState(),console.log("--- âœ… Application Ready ---")})}();
